import{d as T,r as u,u as A,q as L,o as V,s as I,f as n,c as i,a as e,k as g,v as x,F as w,b as j,t as U,E as W,G as q,w as z,l as M,H as B,j as E,p as G,g as Y,_ as H,n as J,m as K,D,C as P}from"./index-Bt48Nl8M.js";import{u as R,a as Q}from"./taskStore-Cxv6eLKW.js";const X={class:"p-8"},Z=e("h1",{class:"text-2xl font-bold text-primary mb-4"},"Create New Project",-1),ee={class:"mb-4"},te=e("label",{for:"projectName",class:"block text-sm font-medium text-gray-700"},"Project Name",-1),se={class:"mb-4"},ae=e("label",{for:"projectDescription",class:"block text-sm font-medium text-gray-700"},"Description",-1),oe={class:"mb-4"},le=e("label",{for:"allocatedHours",class:"block text-sm font-medium text-gray-700"},"Allocated Hours",-1),ne={class:"mb-4"},re=e("label",{for:"startDate",class:"block text-sm font-medium text-gray-700"},"Start Date",-1),ce={class:"mb-4"},de=e("label",{for:"endDate",class:"block text-sm font-medium text-gray-700"},"End Date",-1),ue={class:"mb-4"},ie=e("label",{class:"block text-sm font-medium text-gray-700"},"Assign Team Members and Roles",-1),me={class:"h-48 overflow-y-auto border border-gray-300 rounded-md p-2"},pe=["value","onChange"],ve=["onUpdate:modelValue"],_e=e("option",{value:"member"},"Member",-1),be=e("option",{value:"leader"},"Leader",-1),fe=[_e,be],he={class:"mb-4"},ke=e("label",{class:"block text-sm font-medium text-gray-700"},"Select Task Template",-1),ye={class:"h-48 overflow-y-auto border border-gray-300 rounded-md p-2"},ge=["value"],xe=e("span",null,"Start without template",-1),we=e("button",{type:"submit",class:"bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded"},"Save Project and Continue",-1),je=T({__name:"NewProjectSetup",setup(y){var b;const m=u([]),c=A(),h=L(),p=R(),d=u({}),o=u(void 0),s=u([]);V(async()=>{await c.fetchAllUsers(),await p.fetchTaskTemplates(),console.log("all task tamplates",p.taskTemplates),m.value=c.getUsers,m.value.forEach(l=>d.value[l._id]="member")});const k=I(()=>{var l;return(l=c.user)==null?void 0:l._id}),r=I(()=>m.value.filter(l=>l._id!==k.value)),S=I(()=>p.taskTemplates),v=u({name:"",creationStatus:"tasks",selectedTemplate:"",description:"",creator:(b=c.user)==null?void 0:b._id,startDate:new Date(new Date().toISOString().split("T")[0]),endDate:new Date(new Date().toISOString().split("T")[0]),allocatedHours:0,teamMembers:[]}),C=(l,t)=>{l.target.checked?s.value.push(t):s.value=s.value.filter(f=>f!==t)},_=async()=>{const l={...v.value,creationStatus:"tasks",selectedTemplate:o.value,startDate:new Date(v.value.startDate),endDate:new Date(v.value.endDate),teamMembers:s.value.map(t=>({_id:t,role:d.value[t]})),lists:[]};console.log("Project Data:",l),console.log("Selected Team Members:",s.value),console.log("Roles:",d.value);try{const t=await h.createProject(l);alert("Project created successfully!"),M.replace(`/projects/${t._id}`)}catch(t){alert("Failed to create project"),console.error(t)}};return(l,t)=>(n(),i("div",X,[Z,e("form",{onSubmit:z(_,["prevent"]),class:"grid grid-cols-2 gap-4"},[e("div",null,[e("div",ee,[te,g(e("input",{type:"text",id:"projectName","onUpdate:modelValue":t[0]||(t[0]=a=>v.value.name=a),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[x,v.value.name]])]),e("div",se,[ae,g(e("textarea",{id:"projectDescription","onUpdate:modelValue":t[1]||(t[1]=a=>v.value.description=a),rows:"3",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm"},null,512),[[x,v.value.description]])]),e("div",oe,[le,g(e("input",{type:"number",id:"allocatedHours","onUpdate:modelValue":t[2]||(t[2]=a=>v.value.allocatedHours=a),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[x,v.value.allocatedHours,void 0,{number:!0}]])]),e("div",ne,[re,g(e("input",{type:"date",id:"startDate","onUpdate:modelValue":t[3]||(t[3]=a=>v.value.startDate=a),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[x,v.value.startDate]])]),e("div",ce,[de,g(e("input",{type:"date",id:"endDate","onUpdate:modelValue":t[4]||(t[4]=a=>v.value.endDate=a),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[x,v.value.endDate]])])]),e("div",null,[e("div",ue,[ie,e("div",me,[(n(!0),i(w,null,j(r.value,a=>(n(),i("div",{key:a._id,class:"flex items-center space-x-3 mb-2"},[e("input",{type:"checkbox",value:a._id,onChange:f=>C(f,a._id)},null,40,pe),e("span",null,U(a.username),1),g(e("select",{"onUpdate:modelValue":f=>d.value[a._id]=f},fe,8,ve),[[W,d.value[a._id]]])]))),128))])]),e("div",he,[ke,e("div",ye,[(n(!0),i(w,null,j(S.value,a=>(n(),i("div",{key:a._id,class:"flex items-center space-x-3 mb-2"},[g(e("input",{type:"radio",value:a._id,"onUpdate:modelValue":t[5]||(t[5]=f=>o.value=f)},null,8,ge),[[q,o.value]]),e("span",null,U(a.name),1)]))),128)),e("div",null,[g(e("input",{type:"radio",value:"","onUpdate:modelValue":t[6]||(t[6]=a=>o.value=a)},null,512),[[q,o.value]]),xe])])])]),we],32)]))}}),F=()=>Math.floor(Math.random()*1e3).toString(),Te=["onUpdate:modelValue"],Se=["onClick"],De=T({__name:"NewProjectTasksItem",props:{list:{}},setup(y){const m=y,c=u(""),h=async()=>{if(c.value.trim()===""){alert("Task name cannot be empty");return}const d={_id:F(),name:c.value,description:""};m.list.tasks.push(d),c.value=""},p=async d=>{const o=m.list.tasks.findIndex(s=>s._id===d);m.list.tasks.splice(o,1)};return(d,o)=>(n(),i(w,null,[(n(!0),i(w,null,j(d.list.tasks,s=>(n(),i("div",{key:s._id,class:"flex justify-between items-center mb-2"},[g(e("input",{type:"text","onUpdate:modelValue":k=>s.name=k},null,8,Te),[[x,s.name]]),e("div",null,[e("button",{onClick:k=>p(s._id),class:"text-red-500"},"Delete",8,Se)])]))),128)),e("div",null,[g(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>c.value=s)},null,512),[[x,c.value]]),e("button",{onClick:h,class:"bg-green-500 text-white py-2 px-4 rounded"},"Add Task")])],64))}}),Ie=y=>(G("data-v-bbfba85c"),y=y(),Y(),y),Ue={class:"flex space-x-4 overflow-x-auto mt-8"},Ce={class:"flex space-y-4"},$e={class:"text-xl font-bold"},Pe=["onClick"],Le={class:"flex-col space-y-4 ml-4"},Ve=Ie(()=>e("div",{class:"p-8"},null,-1)),Me={class:"flex space-x-4"},Ne=T({__name:"NewProjectTasks",setup(y){const m=B(),c=L(),h=Q(),p=R(),d=m.query.projectId,o=u(!0),s=u(null);u([]),u({});const k=u("");u("");const r=u(null);V(async()=>{try{s.value=await c.fetchProjectById(d),s.value&&s.value.selectedTemplate&&(await p.fetchTaskTemplates(),r.value=p.taskTemplates.find(_=>{var b;return _._id===((b=s.value)==null?void 0:b.selectedTemplate)})||null,console.log("selected tempalte is:",r.value))}catch(_){console.error("Error fetching project or tasks:",_)}finally{o.value=!1}});const S=async()=>{var _;if(k.value.trim()===""){alert("List name cannot be empty");return}(_=r.value)==null||_.lists.push({_id:F(),name:k.value,tasks:[]}),k.value=""},v=_=>{var l,t;const b=(l=r.value)==null?void 0:l.lists.findIndex(a=>a._id===_);b!==void 0&&((t=r.value)==null||t.lists.splice(b,1))},C=async()=>{var _,b;if(s.value){for(const a of((_=r.value)==null?void 0:_.lists)||[]){const f=await h.createList({name:a.name,projectId:((b=s.value)==null?void 0:b._id)??"",tasks:[]});for(const $ of a.tasks)await p.createTask(f._id,{listId:f._id,name:$.name,description:"",status:"todo",assignedMembers:[],hoursAllocated:0,hoursUsed:0,subTasks:[]});await p.fetchTasks(f._id);const O=p.tasks.map($=>$._id),N={_id:f._id,name:f.name,projectId:f.projectId,tasks:O};console.log("The newListWithTasks is:",N),await h.updateList(N)}if(!s.value)return;const l=await h.fetchLists(s.value._id??"");s.value.lists=l==null?void 0:l.map(a=>a._id),s.value.creationStatus="management";const t={...s.value};delete t.__v,await c.updateProject(t),M.replace(`/projects/${s.value._id}`)}};return(_,b)=>{var l;return n(),i(w,null,[e("div",Ue,[(n(!0),i(w,null,j((l=r.value)==null?void 0:l.lists,t=>(n(),i("div",{key:t._id,class:"flex-col space-y-4"},[e("span",Ce,[e("h2",$e,U(t.name),1),e("button",{onClick:a=>v(t._id),class:"text-red-500"},"Delete List",8,Pe)]),e("div",Le,[E(De,{list:t},null,8,["list"])])]))),128))]),Ve,e("div",Me,[g(e("input",{type:"text","onUpdate:modelValue":b[0]||(b[0]=t=>k.value=t),class:"border border-gray-300 p-2"},null,512),[[x,k.value]]),e("button",{onClick:S,class:"bg-green-500 text-white py-2 px-4 rounded"},"Add List")]),e("button",{onClick:C,class:"bg-accent text-white py-2 px-4 rounded mt-4"},"Save and Continue")],64)}}}),qe=H(Ne,[["__scopeId","data-v-bbfba85c"]]),Ae={};function Be(y,m){return n(),i("p",null,"You are now in the management stage")}const Ee=H(Ae,[["render",Be]]),He={class:"flex space-x-4 overflow-x-auto"},Re=T({__name:"StepIndicator",props:{steps:{},indicator:{}},setup(y){const m=y,c=h=>m.indicator===h.toLowerCase()?"bg-green-500":"bg-gray-100";return(h,p)=>(n(),i("div",He,[(n(!0),i(w,null,j(h.steps,(d,o)=>(n(),i("div",{key:o,class:J(["bg-gray-100 rounded-lg p-4 w-80",c(d)])},U(d),3))),128))]))}}),Fe={key:0},ze=T({__name:"NewProjectView",setup(y){const m=A(),c=L(),h=B(),p=u([]),d=u({}),o=u(""),s=I(()=>{var r;return((r=c.getProjectById(o.value))==null?void 0:r.creationStatus)||"setup"}),k=u(!0);return u(null),K(()=>h.query.projectId,async r=>{o.value=r||""}),V(async()=>{try{await m.fetchAllUsers(),p.value=m.getUsers,p.value.forEach(r=>d.value[r._id]="member"),o.value=M.currentRoute.value.query.projectId||"",console.log("projectId",o.value)}catch(r){console.error("Error fetching users:",r)}finally{k.value=!1}o.value&&await c.fetchProjectById(o.value)}),(r,S)=>(n(),i(w,null,[k.value?(n(),i("div",Fe,"Loading...")):D("",!0),E(Re,{steps:["Setup","Tasks","Management"],indicator:s.value},null,8,["indicator"]),s.value=="setup"?(n(),P(je,{key:1})):D("",!0),s.value=="tasks"?(n(),P(qe,{key:2,projectId:o.value},null,8,["projectId"])):D("",!0),s.value=="management"?(n(),P(Ee,{key:3,projectId:o.value},null,8,["projectId"])):D("",!0)],64))}});export{ze as default};
